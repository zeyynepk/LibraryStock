@using LibraryStock.App.Models
@inject LibraryStock.App.Services.IAuthService Auth

<table class="table table-striped table-hover align-middle">
    <thead>
        <tr>
            <th>ID</th>
            <th>Kullanıcı Adı</th>
            <th>E-posta</th>
            <th>Şifre</th>
            <th>RolID</th>
            <th>Rol</th>
            <th>Son Giriş</th>
            <th>Oluşturulma</th>
            <th class="text-end">İşlemler</th>
        </tr>
    </thead>
    <tbody>
        @if (Users != null && Users.Count > 0)
        {
            for (int i = 0; i < Users.Count; i++)
            {
                var u = Users[i];
                <UserRow Item="u"
                         ShowPlainPassword="isAdmin" 
                         OnEdit="OnEditRow"
                         OnDelete="OnDeleteRow" />
            }
        }
        else
        {
            <tr>
               @*  Bu hücreyi 9 sütunu birden kaplayacak şekilde uzat *@
                <td colspan="9" class="text-center text-muted">Kayıt bulunamadı.</td>
            </tr>
        }
    </tbody>
</table>

@code {
    [Parameter] public List<User> Users { get; set; } = new List<User>();
    [Parameter] public EventCallback<User> OnEdit { get; set; }
    [Parameter] public EventCallback<User> OnDelete { get; set; }

    private bool isAdmin = false;

    protected override void OnInitialized()
    {
        var role = Auth.GetCurrentRole(); //Oturumdaki kullanıcının rolünü (Admin/Personel) ister.

        if (role.HasValue && role.Value == Role.Admin)
        {
            isAdmin = true;
        }
    }

    private async Task OnEditRow(User u) //Bu fonksiyon Düzenle butonuna basıldığında çağrılır.
    {
        if (OnEdit.HasDelegate) 
        { 
            await OnEdit.InvokeAsync(u); 
           //EventCallback = telefon hattı.
           // InvokeAsync = o hattı çevirmek ve karşı tarafa haber vermek.
        }
    }

    private async Task OnDeleteRow(User u) //Sil butonuna basıldığında çağrılır.
    {
        if (OnDelete.HasDelegate) 
        { 
            await OnDelete.InvokeAsync(u); 
        }
    }
}
